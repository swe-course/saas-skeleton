name: Build
on:
  push:
    branches:
      - main
  pull_request:
    types: [opened, synchronize, reopened]
  workflow_dispatch:
    inputs:
      build:
        description: 'Build'
        required: true
        type: boolean
        default: true
      test:
        description: 'Unit Tests'
        required: true
        type: boolean
        default: true
      analysis:
        description: 'Static Code Analisys'
        required: true
        type: boolean
        default: true
      package:
        description: 'Package & Upload'
        required: true
        type: boolean
        default: false
      construct:
        description: 'Construct Infractucture'
        required: true
        type: boolean
        default: false
      deploy:
        description: 'Deploy'
        required: true
        type: boolean
        default: false
      e2e:
        description: 'e2e Tests'
        required: true
        default: 'skip'
        type: choice
        options:
        - skip
        - smoke
        - api
        - full
      undeploy:
        description: 'Undeploy'
        required: true
        type: boolean
        default: false
      deconstruct:
        description: 'Deconstruct Infractucture'
        required: true
        type: boolean
        default: false
    
jobs:
  sonarcloud:
    name: Static Code Analisys
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0  # Shallow clones should be disabled for a better relevancy of analysis
      - name: SonarCloud Scan
        uses: SonarSource/sonarcloud-github-action@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Needed to get PR information, if any
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
